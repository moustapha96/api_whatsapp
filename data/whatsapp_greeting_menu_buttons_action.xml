<?xml version="1.0" encoding="utf-8"?>
<!-- Actions pour les boutons du menu d'accueil (Mes factures, Autre) -->
<odoo>
    <!-- Bouton "Mes factures" : dÃ©clenche le mÃªme flux que le texte 'mes factures' / 'voir mes facture' -->
    <record id="action_btn_menu_invoices" model="whatsapp.button.action">
        <field name="name">Menu - Mes factures</field>
        <field name="button_id">btn_menu_invoices</field>
        <field name="action_type">custom_python</field>
        <field name="python_code"><![CDATA[
_logger.info("=== Bouton Menu Mes factures ===")

try:
    # On rÃ©utilise l'action automatique existante 'auto_send_all_invoices'
    auto_action = env['whatsapp.button.action'].search([
        ('button_id', '=', 'auto_send_all_invoices'),
        ('active', '=', True)
    ], limit=1)

    if auto_action:
        _logger.info("Action auto_send_all_invoices trouvÃ©e, exÃ©cution depuis le bouton 'Mes factures'")
        auto_action.execute_action(message, contact, button_id=button_id)
        message.content = "Envoi de vos factures en cours..."
    else:
        _logger.warning("Aucune action auto_send_all_invoices trouvÃ©e pour le bouton 'Mes factures'")
        message.content = "Fonction 'Mes factures' non disponible pour le moment."
except Exception as e:
    _logger.exception("Erreur dans le bouton 'Mes factures' du menu: %s", str(e))
    message.content = f"Erreur Mes factures: {str(e)}"

_logger.info("=== Fin Bouton Menu Mes factures ===")
]]></field>
        <field name="sequence">4</field>
        <field name="active">True</field>
        <field name="description">Quand le client clique sur 'Mes factures', on dÃ©clenche l'action d'envoi des factures impayÃ©es (plus ancienne d'abord).</field>
    </record>

    <!-- Bouton "Autre" : simple message d'information -->
    <record id="action_btn_menu_other" model="whatsapp.button.action">
        <field name="name">Menu - Autre demande</field>
        <field name="button_id">btn_menu_other</field>
        <field name="action_type">send_message</field>
        <field name="message_to_send">Merci pour votre message ğŸ™\nExpliquez-nous votre demande et un membre de l'Ã‰quipe CCTS vous rÃ©pondra.</field>
        <field name="sequence">5</field>
        <field name="active">True</field>
        <field name="description">RÃ©ponse simple quand le client choisit 'Autre'.</field>
    </record>
</odoo>


